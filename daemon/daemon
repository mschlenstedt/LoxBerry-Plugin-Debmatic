#!/bin/bash

if [ -e "$LBPCONFIG/debmatic_installed" ]; then
	exit 0
fi

echo "<INFO> Installing Debmatic..."
apt-get --no-install-recommends -y --allow-unauthenticated --fix-broken --reinstall --allow-downgrades --allow-remove-essential --allow-change-held-packages install debmatic cuxd xml-api

echo "<INFO> Disabling Debmatic SSDPD Service (LoxBerry has it's own service)..."
systemctl stop debmatic-ssdpd
systemctl disable debmatic-ssdpd
systemctl stop debmatic
systemctl stop lighttpd

echo "<INFO> Changing Homematic WebUI Port to 8081"
/bin/sed -i 's#^server\.port\(\s*\)=\(.*\)$#server\.port\1= 8081#' /etc/lighttpd/lighttpd.conf
/bin/sed -i 's#^var\.debmatic_webui_http_port\(\s*\)=\(.*\)$#var\.debmatic_webui_http_port\1= 8081#' /etc/debmatic/webui.conf

touch $LBPCONFIG/debmatic_installed

#rm $0
reboot

exit 0
